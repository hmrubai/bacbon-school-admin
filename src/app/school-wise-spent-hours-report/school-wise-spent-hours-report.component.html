<block-ui>
  <div class="col-12">
    <div class="card mb-0">
      <div class="card-header">
        <h2 class="mb-0"><i class="fa fa-clock"></i>&nbsp;
          School wise spent Hours on Videos, Scripts & Tests</h2>
      </div>

      <div class="card-body p-0">
        <div class="row">

          <div class="col-lg-4 col-md-6 col-12">
            <app-card [hidHeader]="true" [isCardFooter]="true" footerClass="bg-c-red">
              <div class="row align-items-center">
                <div class="col-lg-8 col-md-8 col-12">
                  <h2 class="text-c-red"><strong><b>{{TotalVideoSpentTime}}</b></strong></h2>
                  <h4 class="text-uppercase mb-0" style="color: gray;"><strong><b>Total Spent Hours on
                        Videos</b></strong></h4>
                </div>
                <div class="col-lg-4 col-md-4 col-12 text-right">
                  <img src="assets/images/multimedia.png" class="wid-60">
                </div>
              </div>

            </app-card>
          </div>
          <div class="col-lg-4 col-md-6 col-12">
            <app-card [hidHeader]="true" [isCardFooter]="true" footerClass="bg-c-yellow">
              <div class="row align-items-center">
                <div class="col-lg-8 col-md-8 col-12">
                  <h2 class="text-c-yellow"><strong><b>{{TotalScriptTime}}</b></strong></h2>
                  <h4 class="text-uppercase mb-0" style="color: gray;"><strong><b>Total Spent Hours on
                        Scripts</b></strong></h4>
                </div>
                <div class="col-lg-4 col-md-4 col-12 text-right">
                  <img src="assets/images/document.png" class="wid-60">
                </div>
              </div>

            </app-card>
          </div>
          <div class="col-lg-4 col-md-6 col-12">
            <app-card [hidHeader]="true" [isCardFooter]="true" footerClass="bg-c-blue">
              <div class="row align-items-center">
                <div class="col-lg-8 col-md-8 col-12">
                  <h2 class="text-c-blue"><strong><b>{{TotalExamSpentTime}}</b></strong></h2>
                  <h4 class="text-uppercase mb-0" style="color: gray;"><strong><b>Total Spent Hours on
                        Tests</b></strong></h4>
                </div>
                <div class="col-lg-4 col-md-4 col-12 text-right">
                  <img src="assets/images/exam.png" class="wid-60">
                </div>
              </div>
              <div class="app-card-footer">
                <div class="row align-items-center">
                  <div class="col-9">

                  </div>
                  <div class="col-3 text-right">

                  </div>
                </div>
              </div>
            </app-card>
          </div>
        </div>
        <div class="card card-border-default">
          <div class="card-body pt-2 pb-2">
            <form class="col-lg-4 offset-lg-4 col-12">
              <div class="form-group row mb-0">
                <label class="col-lg-3 col-md-4 col-12 col-form-label required">School </label>
                <div class="col-lg-9 col-md-8 col-12">
                  <ng-select [(ngModel)]="schoolId" [ngModelOptions]="{standalone: true}" [clearable]="false"
                    [clearOnBackspace]="false" [items]="schoolList" bindLabel="Name" bindValue="ID"
                    placeholder="Select a school" (change)="onChangeSchool($event)">
                  </ng-select>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div class="row">
         
          <div class="col-12 ">
            <ng-container *ngFor="let item of classes">
              <div class="card card-border-default">
                <div class="card-header p-1">
                  <div class="alert alert-danger p-2 m-0 cursor-pointer text-center" (click)="item.collapsed = !item.collapsed"
                    [attr.aria-expanded]="!item.collapsed">
                    <button class="btn btn-icon btn-mini"
                      [ngClass]="{'btn-success': item.collapsed, 'btn-danger': !item.collapsed }">
                      <i class="feather" [ngClass]="{'icon-plus': item.collapsed, 'icon-minus': !item.collapsed }"></i>
                    </button> {{item.Name}}
                  </div>
                  <!-- <h5><i class="fa fa-video"></i> Videos Completed</h5> -->
                </div>
                <div class="card-body p-0 pb-2" id="collapse{{item.ID}}" [collapse]="item.collapsed"
                  [isAnimated]="true">
                  <div class="row">
                    <div class="col-12 row">
                      <div class="col-lg-4 col-md-6 col-12">
                        <app-card [hidHeader]="true" [isCardFooter]="true" footerClass="bg-c-red">
                          <div class="row align-items-center">
                            <div class="col-lg-8 col-md-8 col-12">
                              <h2 class="text-c-red"><strong><b>{{item.TotalVideoSpentTime}}</b></strong></h2>
                              <h4 class="text-uppercase mb-0" style="color: gray;"><strong><b>Total Spent Hours on
                                    Videos</b></strong></h4>
                            </div>
                            <div class="col-lg-4 col-md-4 col-12 text-right">
                              <img src="assets/images/multimedia.png" class="wid-60">
                            </div>
                          </div>
            
                        </app-card>
                      </div>
                      <div class="col-lg-4 col-md-6 col-12">
                        <app-card [hidHeader]="true" [isCardFooter]="true" footerClass="bg-c-yellow">
                          <div class="row align-items-center">
                            <div class="col-lg-8 col-md-8 col-12">
                              <h2 class="text-c-yellow"><strong><b>{{item.TotalScriptTime}}</b></strong></h2>
                              <h4 class="text-uppercase mb-0" style="color: gray;"><strong><b>Total Spent Hours on
                                    Scripts</b></strong></h4>
                            </div>
                            <div class="col-lg-4 col-md-4 col-12 text-right">
                              <img src="assets/images/document.png" class="wid-60">
                            </div>
                          </div>
            
                        </app-card>
                      </div>
                      <div class="col-lg-4 col-md-6 col-12">
                        <app-card [hidHeader]="true" [isCardFooter]="true" footerClass="bg-c-blue">
                          <div class="row align-items-center">
                            <div class="col-lg-8 col-md-8 col-12">
                              <h2 class="text-c-blue"><strong><b>{{item.TotalExamSpentTime}}</b></strong></h2>
                              <h4 class="text-uppercase mb-0" style="color: gray;"><strong><b>Total Spent Hours on
                                    Tests</b></strong></h4>
                            </div>
                            <div class="col-lg-4 col-md-4 col-12 text-right">
                              <img src="assets/images/exam.png" class="wid-60">
                            </div>
                          </div>
                          <div class="app-card-footer">
                            <div class="row align-items-center">
                              <div class="col-9">
            
                              </div>
                              <div class="col-3 text-right">
            
                              </div>
                            </div>
                          </div>
                        </app-card>
                      </div>
                    </div>
                  </div>
                  <!-- Video -->
                  <div class="card card-border-default">
                    <div class="card-header p-0">
                      <div class="alert alert-info p-2 m-0 cursor-pointer" (click)="item.videoCollapsed = !item.videoCollapsed"
                        [attr.aria-expanded]="!item.videoCollapsed" aria-controls="collapseVideo">
                        <button class="btn btn-icon btn-mini"
                          [ngClass]="{'btn-success': item.videoCollapsed, 'btn-danger': !item.videoCollapsed }">
                          <i class="feather"
                            [ngClass]="{'icon-plus': item.videoCollapsed, 'icon-minus': !item.videoCollapsed }"></i>
                        </button> Video Seen Progress
                      </div>
                      <!-- <h5><i class="fa fa-video"></i> Videos Completed</h5> -->
                    </div>
                    <div class="card-body p-0 pb-2" id="collapseVideo" [collapse]="item.videoCollapsed" [isAnimated]="true">
                      <div class="row ">
                        <div class="col-md-6 col-lg-6 col-12 " *ngFor="let subject of item.subjects">
                          <div class="card">
                            <div class="card-header">
                              <div class="row">
                                <div class="col-md-10 col-12">
                                  <h5><b>VIDEO COMPLETED | {{subject.Name}}</b></h5>
                                </div>
                                <div class="col-md-2 col-12 text-right ">

                                  <button class="btn  btn-info btn-mini" [routerLink]="['/employee-entry']"
                                    [placement]="'top'" ngbTooltip="Download Excel" [queryParams]="{ id: 1}"
                                    queryParamsHandling="merge">
                                    <i class="feather icon-download"></i>
                                  </button>

                                </div>
                              </div>
                            </div>
                            <div class="card-body">
                              <div class="row scroll">
                                <div class="table-responsive">
                                  <table class="table table-sm table-hover table-bordered table-striped">
                                    <thead>
                                      <tr>
                                        <th scope="col"># </th>
                                        <th scope="col">Video Title</th>
                                        <th scope="col" class="text-wrap" style="width: 10%">Watched Duration</th>
                                        <th scope="col" class="text-wrap" style="width: 10%">Seen (Times)</th>
                                        <th scope="col" class="text-wrap" style="width: 10%">Completed</th>

                                      </tr>
                                    </thead>

                                    <tbody>
                                      <tr *ngFor="let video of subject.Videos let i = index">
                                        <td>
                                          {{i+1}}
                                        </td>
                                        <td>
                                          <span>{{video.Name}}</span>
                                        </td>
                                        <td>
                                          <ng-container *ngIf="video.SeenDurationSec >= 1; else videoSeenElseTemplate">
                                            <ng-container *ngIf="video.SeenDurationSec / 60  < 1; else elseTemplate">
                                              Less than a minute
                                            </ng-container>
                                            <ng-template #elseTemplate>
                                              {{video.SeenDurationSec / 60 | floor }} mint
                                              {{video.SeenDurationSec % 60 | number:'1.0-0'}} sec
                                            </ng-template>
                                          </ng-container>
                                          <ng-template #videoSeenElseTemplate>
                                            N/A
                                          </ng-template>
                                        </td>
                                        <td class="text-right">{{video.SeenTimes}}</td>
                                        <td class="text-center">
                                          <i *ngIf="video.Completed" class="fa fa-check-square text-success"></i>
                                          <i *ngIf="!video.Completed" class="fa fa-window-close text-danger"></i>
                                        </td>
                                      </tr>
                                    </tbody>

                                  </table>
                                </div>

                              </div>

                            </div>
                          </div>

                        </div>

                      </div>

                    </div>
                  </div>

                  <!-- Script -->
                  <div class="card card-border-default">
                    <div class="card-header p-0">
                      <div class="alert alert-success p-2 m-0 cursor-pointer"
                        (click)="item.scriptCollapsed = !item.scriptCollapsed" [attr.aria-expanded]="!item.scriptCollapsed"
                        aria-controls="collapseScript">
                        <button class="btn btn-icon btn-mini"
                          [ngClass]="{'btn-success': item.scriptCollapsed, 'btn-danger': !item.scriptCollapsed }">
                          <i class="feather"
                            [ngClass]="{'icon-plus': item.scriptCollapsed, 'icon-minus': !item.scriptCollapsed }"></i>
                        </button> Script Progress
                      </div>
                      <!-- <h5><i class="fa fa-video"></i> </h5> -->
                    </div>
                    <div class="card-body" id="collapseScript" [collapse]="item.scriptCollapsed" [isAnimated]="true">
                      <div class="row ">
                        <ng-container *ngFor="let subject of item.subjects">
                          <div class="col-md-6 col-lg-6 col-12" *ngIf="subject.Scripts.length > 0">
                            <div class="card">
                              <div class="card-header">
                                <div class="row">
                                  <div class="col-md-10 col-12">
                                    <h5><b>Scripts | {{subject.Name}}</b></h5>
                                  </div>
                                  <div class="col-md-2 col-12 text-right ">

                                    <button class="btn  btn-info btn-mini " [routerLink]="['/employee-entry']"
                                      [placement]="'top'" ngbTooltip="Download Excel" [queryParams]="{ id: 1}"
                                      queryParamsHandling="merge">
                                      <i class="feather icon-download"></i>
                                    </button>

                                  </div>
                                </div>
                              </div>
                              <div class="card-body">
                                <div class="row scroll">
                                  <div class="table-responsive">
                                    <table class="table table-sm table-hover table-bordered table-striped">
                                      <thead>
                                        <tr>
                                          <th scope="col"># </th>
                                          <th scope="col">Script Title</th>
                                          <th scope="col" class="text-wrap" style="width: 10%">Spent Duration</th>
                                          <th scope="col" class="text-wrap" style="width: 10%">Seen (Times)</th>
                                        </tr>
                                      </thead>

                                      <tbody>
                                        <tr *ngFor="let script of subject.Scripts let i = index">
                                          <td>
                                            {{i+1}}
                                          </td>
                                          <td>
                                            <span>{{script.Name}}</span>
                                          </td>
                                          <td>
                                            <ng-container
                                              *ngIf="script.SeenDurationSec >= 1; else scriptSeenElseTemplate">
                                              <ng-container *ngIf="script.SeenDurationSec / 60  < 1; else elseTemplate">
                                                Less than a minute
                                              </ng-container>
                                              <ng-template #elseTemplate>
                                                {{script.SeenDurationSec / 60 | floor }} mint
                                                {{script.SeenDurationSec % 60 | number:'1.0-0'}} sec
                                              </ng-template>
                                            </ng-container>
                                            <ng-template #scriptSeenElseTemplate>
                                              N/A
                                            </ng-template>
                                          </td>
                                          <td class="text-right">{{script.SeenTimes}}</td>
                                        </tr>
                                      </tbody>

                                    </table>
                                  </div>

                                </div>

                              </div>
                            </div>
                          </div>
                        </ng-container>
                      </div>

                    </div>
                  </div>

                  <!-- Small Test -->
                  <div class="card card-border-default">
                    <div class="card-header p-0">
                      <div class="alert alert-success p-2 m-0 cursor-pointer"
                        (click)="item.smallTestCollapsed = !item.smallTestCollapsed" [attr.aria-expanded]="!item.smallTestCollapsed"
                        aria-controls="collapseSmallTest">
                        <button class="btn btn-icon btn-mini"
                          [ngClass]="{'btn-success': item.smallTestCollapsed, 'btn-danger': !item.smallTestCollapsed }">
                          <i class="feather"
                            [ngClass]="{'icon-plus': item.smallTestCollapsed, 'icon-minus': !item.smallTestCollapsed }"></i>
                        </button> Test Progress
                      </div>
                      <!-- <h5><i class="fa fa-file"></i> Test History </h5> -->
                    </div>
                    <div class="card-body p-0 pb-2" id="collapseSmallTest" [collapse]="item.smallTestCollapsed"
                      [isAnimated]="true">
                      <div class="row ">
                        <div class="col-md-6 col-lg-6 col-12 " *ngFor="let subject of item.subjects">
                          <div class="card">
                            <div class="card-header">
                              <div class="row">
                                <div class="col-md-10 col-12">
                                  <h5><b>TEST PARTICIPATION | {{subject.Name}}</b></h5>
                                </div>
                                <div class="col-md-2 col-12  text-right">

                                  <button class="btn  btn-info btn-mini " [routerLink]="['/employee-entry']"
                                    [placement]="'top'" ngbTooltip="Download Excel" [queryParams]="{ id: 1}"
                                    queryParamsHandling="merge">
                                    <i class="feather icon-download"></i>
                                  </button>

                                </div>
                              </div>
                            </div>
                            <div class="card-body">
                              <div class="row scroll">
                                <div class="table-responsive">
                                  <table class="table table-sm table-hover table-bordered table-striped">
                                    <thead>
                                      <tr>
                                        <th scope="col" style="width: 10%"># </th>
                                        <th scope="col">Test</th>
                                        <th scope="col" style="width: 10%">Compelted</th>
                                        <th scope="col" class="text-wrap" style="width: 10%">Participation (Times)</th>
                                        <th scope="col" class="text-wrap" style="width: 10%">Details</th>
                                      </tr>
                                    </thead>

                                    <tbody>
                                      <tr *ngFor="let test of subject.SmallTests; let i = index">
                                        <td>
                                          {{i+1}}
                                        </td>

                                        <td>
                                          <span>{{test.Name}}</span>
                                        </td>

                                        <td class="text-center" style="width: 10%">
                                          <i *ngIf="test.Completed" class="fa fa-check-square text-success"></i>
                                          <i *ngIf="!test.Completed" class="fa fa-window-close text-danger"></i>
                                        </td>
                                        <td class="text-wrap" style="width: 10%">
                                          {{test.Participation}}
                                        </td>
                                        <td class="text-wrap" style="width: 10%">
                                          <!-- <button class="btn btn-icon btn-info btn-mini ml-1 mb-1" [placement]="'left'"
                                            *ngIf="test.Participation>0" ngbTooltip="Show Result"
                                            [routerLink]="['/test-result-list',test.ID,Learner.ID]">
                                            <i class="fa fa-info"></i>
                                          </button> -->
                                          <span *ngIf="test.Participation<=0">N/A</span>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </div>
                              </div>
                            </div>
                          </div>

                        </div>

                      </div>

                    </div>
                  </div>

                  <!-- Graph -->
                  <div class="card card-border-default mb-0">
                    <div class="card-header p-0">
                      <div class="alert alert-warning p-2 m-0 cursor-pointer" (click)="item.graphCollapsed = !item.graphCollapsed"
                        [attr.aria-expanded]="!item.graphCollapsed" aria-controls="collapseGraph">
                        <button class="btn btn-icon btn-mini"
                          [ngClass]="{'btn-success': item.graphCollapsed, 'btn-danger': !item.graphCollapsed }">
                          <i class="feather"
                            [ngClass]="{'icon-plus': item.graphCollapsed, 'icon-minus': !item.graphCollapsed }"></i>
                        </button> Video Seen Progress in Graph
                      </div>
                    </div>
                    <div class="card-body p-0 pb-2" id="collapseGraph" [collapse]="item.graphCollapsed" [isAnimated]="true">
                      <div class="row ">
                        <div class="col-12 mb-3" *ngFor="let subject of item.subjects">
                          <highcharts-chart *ngIf="subject.ChartOptions" [Highcharts]="highcharts"
                            [options]="subject.ChartOptions" style="width: 100%; height: 260px; display: block;">
                          </highcharts-chart>
                          <hr />
                        </div>
                      </div>

                    </div>
                  </div>

                </div>

              </div>
            </ng-container>
          </div>
        </div>

      </div>

    </div>
  </div>
</block-ui>